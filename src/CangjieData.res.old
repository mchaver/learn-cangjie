// Expanded Cangjie lesson data with words, phrases, chengyu, and sentences
// This module generates lessons dynamically and includes much more content

open Types

// Helper to create character info
let makeChar = (
  char: string,
  code: string,
  radicals: option<array<string>>,
  ~hskLevel: option<int>=?,
  ~frequencyRank: option<int>=?,
  (),
): characterInfo => {
  {
    character: char,
    cangjieCode: CangjieUtils.codeToKeys(code),
    radicals: radicals,
    hskLevel: hskLevel,
    frequencyRank: frequencyRank,
  }
}

// Create lesson structure with section and category
let makeLesson = (
  id: int,
  title: string,
  description: string,
  section: lessonSection,
  category: lessonCategory,
  lessonType: lessonType,
  keys: array<cangjieKey>,
  chars: array<characterInfo>,
  ~showCode: bool=false,
  ~allowHints: bool=true,
  ~allowGiveUp: bool=true,
  ~reviewsLessons: array<int>=[],
  (),
): lesson => {
  {
    id: id,
    title: title,
    description: description,
    section: section,
    category: category,
    lessonType: lessonType,
    introducedKeys: keys,
    characters: chars,
    targetAccuracy: switch category {
    | Radicals => 0.80
    | CommonWords => 0.80
    | Phrases => 0.80
    | Chengyu => 0.80
    | Sentences => 0.75
    | Custom => 0.80
    },
    targetSpeed: Some(switch category {
    | Radicals => 30.0
    | CommonWords => 25.0
    | Phrases => 20.0
    | Chengyu => 25.0
    | Sentences => 15.0
    | Custom => 20.0
    }),
    showCode: showCode,
    allowHints: allowHints,
    allowGiveUp: allowGiveUp,
    reviewsLessons: reviewsLessons,
  }
}

// Character Dictionary - each character defined once
// This is the single source of truth for all characters and their Cangjie codes
let characterDictionary: Belt.Map.String.t<characterInfo> = Belt.Map.String.fromArray([

  // 1-key characters
  ("日", makeChar("日", "A", Some(["日"]), ())),
  ("月", makeChar("月", "B", Some(["月"]), ())),
  ("金", makeChar("金", "C", Some(["金"]), ())),
  ("木", makeChar("木", "D", Some(["木"]), ())),
  ("水", makeChar("水", "E", Some(["水"]), ())),
  ("火", makeChar("火", "F", Some(["火"]), ())),
  ("土", makeChar("土", "G", Some(["土"]), ())),
  ("竹", makeChar("竹", "H", Some(["竹"]), ())),
  ("戈", makeChar("戈", "I", Some(["戈"]), ())),
  ("十", makeChar("十", "J", Some(["十"]), ())),
  ("大", makeChar("大", "K", Some(["大"]), ())),
  ("中", makeChar("中", "L", Some(["中"]), ())),
  ("一", makeChar("一", "M", Some(["一"]), ())),
  ("弓", makeChar("弓", "N", Some(["弓"]), ())),
  ("人", makeChar("人", "O", Some(["人"]), ())),
  ("心", makeChar("心", "P", Some(["心"]), ())),
  ("手", makeChar("手", "Q", Some(["手"]), ())),
  ("口", makeChar("口", "R", Some(["口"]), ())),
  ("尸", makeChar("尸", "S", Some(["尸"]), ())),
  ("廿", makeChar("廿", "T", Some(["廿"]), ())),
  ("山", makeChar("山", "U", Some(["山"]), ())),
  ("女", makeChar("女", "V", Some(["女"]), ())),
  ("田", makeChar("田", "W", Some(["田"]), ())),
  ("卜", makeChar("卜", "Y", Some(["卜"]), ())),

  // 2-key characters
  ("昌", makeChar("昌", "AA", Some(["日", "日"]), ())),
  ("明", makeChar("明", "AB", Some(["日", "月"]), ())),
  ("杲", makeChar("杲", "AD", Some(["日", "木"]), ())),
  ("早", makeChar("早", "AJ", Some(["日", "十"]), ())),
  ("旦", makeChar("旦", "AM", Some(["日", "一"]), ())),
  ("朋", makeChar("朋", "BB", Some(["月", "月"]), ())),
  ("公", makeChar("公", "CI", Some(["金", "戈"]), ())),
  ("杳", makeChar("杳", "DA", Some(["木", "日"]), ())),
  ("林", makeChar("林", "DD", Some(["木", "木"]), ())),
  ("杜", makeChar("杜", "DG", Some(["木", "土"]), ())),
  ("寸", makeChar("寸", "DI", Some(["木", "戈"]), ())),
  ("末", makeChar("末", "DJ", Some(["木", "十"]), ())),
  ("東", makeChar("東", "DW", Some(["木", "田"]), ())),
  ("汉", makeChar("汉", "EE", Some(["水", "水"]), ())),
  ("江", makeChar("江", "EM", Some(["水", "一"]), ())),
  ("炎", makeChar("炎", "FF", Some(["火", "火"]), ())),
  ("小", makeChar("小", "NC", Some(["弓", "金"]), ())),
  ("少", makeChar("少", "FH", Some(["火", "竹"]), ())),
  ("去", makeChar("去", "GI", Some(["土", "戈"]), ())),
  ("白", makeChar("白", "HA", Some(["竹", "日"]), ())),
  ("禾", makeChar("禾", "HD", Some(["竹", "木"]), ())),
  ("千", makeChar("千", "HJ", Some(["竹", "十"]), ())),
  ("八", makeChar("八", "HO", Some(["竹", "人"]), ())),
  ("戊", makeChar("戊", "IH", Some(["戈", "竹"]), ())),
  ("支", makeChar("支", "JE", Some(["十", "水"]), ())),
  ("古", makeChar("古", "JR", Some(["口", "十", "口"]), ())),
  ("有", makeChar("有", "KB", Some(["大", "月"]), ())),
  ("友", makeChar("友", "KE", Some(["大", "水"]), ())),
  ("灰", makeChar("灰", "KF", Some(["大", "火"]), ())),
  ("太", makeChar("太", "KI", Some(["大", "戈"]), ())),
  ("右", makeChar("右", "KR", Some(["大", "口"]), ())),
  ("串", makeChar("串", "LL", Some(["中", "中"]), ())),
  ("由", makeChar("由", "LW", Some(["中", "田"]), ())),
  ("天", makeChar("天", "MK", Some(["一", "大"]), ())),
  ("二", makeChar("二", "MM", Some(["一", "一"]), ())),
  ("石", makeChar("石", "MR", Some(["一", "口"]), ())),
  ("下", makeChar("下", "MY", Some(["一", "卜"]), ())),
  ("弔", makeChar("弔", "NL", Some(["弓", "中"]), ())),
  ("引", makeChar("引", "NL", Some(["弓", "中"]), ())),
  ("入", makeChar("入", "OH", Some(["人", "竹"]), ())),
  ("个", makeChar("个", "OL", Some(["人", "中"]), ())),
  ("必", makeChar("必", "PH", Some(["竹", "心"]), ())),
  ("世", makeChar("世", "PT", Some(["心", "廿"]), ())),
  ("屯", makeChar("屯", "PU", Some(["心", "山"]), ())),
  ("扣", makeChar("扣", "QR", Some(["手", "口"]), ())),
  ("呆", makeChar("呆", "RD", Some(["口", "木"]), ())),
  ("尺", makeChar("尺", "SO", Some(["尸", "戈"]), ())),
  ("尼", makeChar("尼", "SP", Some(["尸", "心"]), ())),
  ("共", makeChar("共", "TC", Some(["廿", "金"]), ())),
  ("卅", makeChar("卅", "TJ", Some(["廿", "一"]), ())),
  ("出", makeChar("出", "UU", Some(["山", "山"]), ())),
  ("如", makeChar("如", "VR", Some(["女", "口"]), ())),
  ("困", makeChar("困", "WD", Some(["田", "木"]), ())),
  ("因", makeChar("因", "WK", Some(["田", "大"]), ())),
  ("甲", makeChar("甲", "WL", Some(["田", "中"]), ())),
  ("思", makeChar("思", "WP", Some(["田", "心"]), ())),
  ("回", makeChar("回", "WR", Some(["田", "口"]), ())),
  ("上", makeChar("上", "YM", Some(["卜", "一"]), ())),
  ("占", makeChar("占", "YR", Some(["卜", "口"]), ())),

  // 3-key characters
  ("同", makeChar("同", "BMR", Some(["月", "一", "口"]), ())),
  ("焚", makeChar("焚", "DDF", Some(["火", "火"]), ())),
  ("竺", makeChar("竺", "HMM", Some(["竹", "土"]), ())),
  ("成", makeChar("成", "IHS", Some(["戈", "十"]), ())),
  ("或", makeChar("或", "IRM", Some(["戈", "口", "一"]), ())),
  ("鹿", makeChar("鹿", "IXP", Some(["難", "戈", "難", "心"]), ())),
  ("字", makeChar("字", "JND", Some(["十", "弓", "木"]), ())),
  ("車", makeChar("車", "JWJ", Some(["十", "田", "十"]), ())),
  ("夾", makeChar("夾", "KOO", Some(["大", "人", "人"]), ())),
  ("央", makeChar("央", "LBK", Some(["中", "月", "大"]), ())),
  ("書", makeChar("書", "LGA", Some(["中", "土", "日"]), ())),
  ("川", makeChar("川", "LLL", Some(["中", "中", "中"]), ())),
  ("弗", makeChar("弗", "LLN", Some(["中", "中", "弓"]), ())),
  ("申", makeChar("申", "LWL", Some(["中", "中"]), ())),
  ("工", makeChar("工", "MLM", Some(["一", "中", "一"]), ())),
  ("三", makeChar("三", "MMM", Some(["一", "一", "一"]), ())),
  ("可", makeChar("可", "MNR", Some(["一", "弓", "口"]), ())),
  ("外", makeChar("外", "NIY", Some(["弓", "戈", "卜"]), ())),
  ("你", makeChar("你", "ONF", Some(["人", "弓", "火"]), ())),
  ("他", makeChar("他", "OPD", Some(["人", "心", "木"]), ())),
  ("拿", makeChar("拿", "ORQ", Some(["人", "口", "手"]), ())),
  ("怕", makeChar("怕", "PHA", Some(["心", "竹", "日"]), ())),
  ("打", makeChar("打", "QMN", Some(["手", "一", "弓"]), ())),
  ("局", makeChar("局", "SSR", Some(["尸", "尸", "口"]), ())),
  ("草", makeChar("草", "TAJ", Some(["廿", "日"]), ())),
  ("若", makeChar("若", "TKR", Some(["廿", "口"]), ())),
  ("岐", makeChar("岐", "UJE", Some(["山", "十", "竹"]), ())),
  ("樂", makeChar("樂", "VID", Some(["女", "戈", "木"]), ())),
  ("好", makeChar("好", "VND", Some(["女", "弓", "木"]), ())),
  ("妃", makeChar("妃", "VSU", Some(["女", "尸", "山"]), ())),
  ("男", makeChar("男", "WKS", Some(["田", "大", "尸"]), ())),
  ("卡", makeChar("卡", "YMY", Some(["卜", "一", "卜"]), ())),

  // 4-key characters
  ("愛", makeChar("愛", "BBPE", Some(["月", "月", "心", "水"]), ())),
  ("樹", makeChar("樹", "DGTI", Some(["木", "土", "廿", "戈"]), ())),
  ("橋", makeChar("橋", "DHKB", Some(["木", "竹", "大", "月"]), ())),
  ("權", makeChar("權", "DTRG", Some(["木", "廿", "口", "土"]), ())),
  ("機", makeChar("機", "DVII", Some(["木", "女", "戈", "戈"]), ())),
  ("河", makeChar("河", "EMNR", Some(["水", "一", "弓", "口"]), ())),
  ("學", makeChar("學", "HBND", Some(["竹", "月", "弓", "木"]), ())),
  ("重", makeChar("重", "HJWG", Some(["竹", "十", "田", "土"]), ())),
  ("與", makeChar("與", "HXYC", Some(["竹", "難", "卜", "金"]), ())),
  ("為", makeChar("為", "IKNF", Some(["戈", "大", "弓", "火"]), ())),
  ("爾", makeChar("爾", "MFBK", Some(["一", "火", "月", "大"]), ())),
  ("個", makeChar("個", "OWJR", Some(["人", "田", "十", "口"]), ())),
  ("羣", makeChar("羣", "SRTQ", Some(["尸", "口", "廿", "手"]), ())),
  ("華", makeChar("華", "TMTJ", Some(["廿", "一", "廿", "十"]), ())),
  ("難", makeChar("難", "TOOG", Some(["廿", "人", "人", "土"]), ())),
  ("藥", makeChar("藥", "TVID", Some(["廿", "女", "戈", "木"]), ())),
  ("變", makeChar("變", "VFOK", Some(["女", "火", "人", "大"]), ())),
  ("巢", makeChar("巢", "VVWD", Some(["難", "難", "竹", "木", "月"]), ())),
  ("園", makeChar("園", "WGRV", Some(["田", "土", "口", "女"]), ())),
  ("國", makeChar("國", "WIRM", Some(["田", "戈", "口", "一"]), ())),
  ("課", makeChar("課", "YRWD", Some(["卜", "口", "田", "木"]), ())),
  ("意", makeChar("意", "YTAP", Some(["卜", "廿", "日", "心"]), ())),

  // 5-key characters
  ("卵", makeChar("卵", "HHSLI", Some(["難", "竹", "手", "火"]), ())),
  ("從", makeChar("從", "HOOOO", Some(["人", "人"]), ())),
  ("拜", makeChar("拜", "HQMQJ", Some(["竹", "手", "一", "手", "十"]), ())),
  ("弱", makeChar("弱", "NMNIM", Some(["弓", "弓"]), ())),
  ("義", makeChar("義", "TGHQI", Some(["廿", "土", "竹", "手", "戈"]), ())),
  ("贏", makeChar("贏", "YNBUC", Some(["卜", "弓", "月", "山", "金"]), ())),
  ("謝", makeChar("謝", "YRHHI", Some(["卜", "口", "竹", "竹", "戈"]), ())),
  ("請", makeChar("請", "YRQMB", Some(["卜", "口", "手", "一", "月"]), ())),
])

// Helper function to get a character from the dictionary
let char = (c: string): characterInfo => {
  switch Belt.Map.String.get(characterDictionary, c) {
  | Some(charInfo) => charInfo
  | None => {
      // This should never happen if the dictionary is complete
      Js.Exn.raiseError("Character \"" ++ c ++ "\" not found in dictionary")
    }
  }
}

// PHILOSOPHY (哲理類) - Lessons 1-7
// Lesson 1: 日 - Learn A (日) - Can only use: A
let lesson1Characters = [
  // Introduce 日
  char("日"),
  char("日"),
  char("日"),
  char("日"),
  char("日"),
  // Characters with 日日
  char("昌"),
  char("昌"),
  char("昌"),
  // Practice mix
  char("日"),
  char("昌"),
  char("日"),
  char("昌"),
  char("日"),
  char("日"),
  char("昌"),
  char("日"),
]

// Lesson 2: 月 - Learn B (月) - Can only use: A, B
let lesson2Characters = [
  // Introduce 月
  char("月"),
  char("月"),
  char("月"),
  char("月"),
  char("月"),
  // Characters with 月
  char("朋"),
  char("朋"),
  char("明"),
  char("明"),
  char("明"),
  // Practice mix with previous
  char("月"),
  char("朋"),
  char("明"),
  char("日"),
  char("月"),
  char("明"),
]

// Lesson 3: 金 - Learn C (金) - Can only use: A, B, C
let lesson3Characters = [
  // Introduce 金
  char("金"),
  char("金"),
  char("金"),
  char("金"),
  char("金"),
  // Practice with previous keys
  char("日"),
  char("月"),
  char("金"),
  char("明"),
  char("金"),
  char("朋"),
  char("金"),
  char("昌"),
  char("金"),
  char("明"),
  char("金"),
]

// Lesson 4: 木 - Learn D (木) - Can only use: A, B, C, D
let lesson4Characters = [
  // Introduce 木
  char("木"),
  char("木"),
  char("木"),
  char("木"),
  char("木"),
  // Characters with 木
  char("林"),
  char("林"),
  char("林"),
  // Practice mix with previous
  char("木"),
  char("林"),
  char("日"),
  char("木"),
  char("月"),
  char("林"),
  char("金"),
  char("木"),
]

// Lesson 5: 水 - Learn E (水) - Can only use: A, B, C, D, E
let lesson5Characters = [
  // Introduce 水
  char("水"),
  char("水"),
  char("水"),
  char("水"),
  char("水"),
  // Characters with 水
  char("汉"),
  char("汉"),
  char("汉"),
  // Practice mix with previous
  char("水"),
  char("汉"),
  char("木"),
  char("水"),
  char("林"),
  char("汉"),
  char("明"),
  char("水"),
]

// Lesson 6: 火 - Learn F (火) - Can only use: A, B, C, D, E, F
let lesson6Characters = [
  // Introduce 火
  char("火"),
  char("火"),
  char("火"),
  char("火"),
  char("火"),
  // Characters with 火
  char("炎"),
  char("炎"),
  char("炎"),
  // Practice mix with previous
  char("火"),
  char("炎"),
  char("水"),
  char("火"),
  char("汉"),
  char("炎"),
  char("林"),
  char("火"),
]

// Lesson 7: 土 - Learn G (土) - Can only use: A, B, C, D, E, F, G
let lesson7Characters = [
  // Introduce 土
  char("土"),
  char("土"),
  char("土"),
  char("土"),
  char("土"),
  // Practice mix with five elements (金木水火土)
  char("土"),
  char("金"),
  char("木"),
  char("水"),
  char("火"),
  char("土"),
  char("炎"),
  char("林"),
  char("汉"),
  char("土"),
  char("明"),
]

// Lesson 8: 竹 - Learn H (竹) - Can only use: A, B, C, D, E, F, G, H
let lesson8Characters = [
  // Introduce 竹
  char("竹"),
  char("竹"),
  char("竹"),
  char("竹"),
  char("竹"),
  // Characters with 竹 (A-H available)
  char("竺"),
  char("竺"),
  char("白"),
  char("白"),
  char("禾"),
  char("禾"),
  char("少"),
  char("少"),
  // Practice mix (removed 皇 - uses M not available yet)
  char("竹"),
  char("白"),
  char("竺"),
  char("禾"),
  char("少"),
  char("竹"),
]

// Lesson 9: 戈 - Learn I (戈) - Can only use: A, B, C, D, E, F, G, H, I
let lesson9Characters = [
  // Introduce 戈
  char("戈"),
  char("戈"),
  char("戈"),
  char("戈"),
  char("戈"),
  // Characters with 戈 (A-I available)
  char("去"),
  char("去"),
  char("公"),
  char("公"),
  char("寸"),
  char("寸"),
  char("戊"), // Fixed code: IH not GI
  char("戊"),
  // Practice mix (removed 戒 - uses T not available)
  char("戈"),
  char("去"),
  char("公"),
  char("戊"),
  char("寸"),
  char("戈"),
]

// Lesson 10: 十 - Learn J (十) - Can only use: A, B, C, D, E, F, G, H, I, J
let lesson10Characters = [
  // Introduce 十
  char("十"),
  char("十"),
  char("十"),
  char("十"),
  char("十"),
  // Characters with 十 (A-J available)
  char("早"),
  char("早"),
  char("末"),
  char("末"),
  char("千"),
  char("千"),
  char("支"),
  char("支"),
  char("成"),
  char("成"),
  // Practice mix (removed 卉 - uses T not available)
  char("十"),
  char("早"),
  char("千"),
  char("成"),
]

// Lesson 11: 大 - Learn K (大) - Can only use: A, B, C, D, E, F, G, H, I, J, K
let lesson11Characters = [
  // Introduce 大
  char("大"),
  char("大"),
  char("大"),
  char("大"),
  char("大"),
  // Characters with 大 (A-K available)
  char("友"),
  char("友"),
  char("灰"),
  char("灰"),
  char("有"),
  char("有"),
  char("太"), // Fixed code: KI not KA
  char("太"),
  // Practice mix (removed 夫 - uses Q,O not available)
  char("大"),
  char("友"),
  char("灰"),
  char("大"),
  char("有"),
  char("太"),
]

// Lesson 12: 中 - Learn L (中) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L
let lesson12Characters = [
  // Introduce 中
  char("中"),
  char("中"),
  char("中"),
  char("中"),
  char("中"),
  // Characters with 中 (A-L available)
  char("申"),
  char("申"),
  char("申"),
  char("串"), // Fixed code: LL not LLL
  char("串"),
  char("央"), // Fixed code: LBK not KLB
  char("央"),
  // Practice mix
  char("中"),
  char("申"),
  char("中"),
  char("串"),
  char("央"),
  char("中"),
]

// Lesson 13: 一 - Learn M (一) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L, M
let lesson13Characters = [
  // Introduce 一
  char("一"),
  char("一"),
  char("一"),
  char("一"),
  char("一"),
  // Characters with 一 (A-M available)
  char("天"),
  char("天"),
  char("旦"),
  char("旦"),
  char("三"),
  char("三"),
  char("二"),
  char("二"),
  char("工"), // Fixed code: MLM not M
  char("工"),
  // Practice mix
  char("一"),
  char("天"),
  char("旦"),
  char("二"),
  char("三"),
]

// Lesson 14: 弓 - Learn N (弓) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L, M, N
let lesson14Characters = [
  // Introduce 弓
  char("弓"),
  char("弓"),
  char("弓"),
  char("弓"),
  char("弓"),
  // Characters with 弓 (A-N available)
  char("引"),
  char("引"),
  char("弱"),
  char("弱"),
  char("弔"), // Fixed code: NL not NJB
  char("弔"),
  char("弗"), // Fixed code: LLN not NHE
  char("弗"),
  // Practice mix
  char("弓"),
  char("引"),
  char("弱"),
  char("弔"),
  char("弓"),
]

// BODY PARTS (人體類) - Lessons 15-18
// Lesson 15: 人 - Learn O (人) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L, M, N, O
let lesson15Characters = [
  // Introduce 人
  char("人"),
  char("人"),
  char("人"),
  char("人"),
  char("人"),
  // Characters with 人 (A-O available)
  char("个"),
  char("个"),
  char("八"),
  char("八"),
  char("從"),
  char("從"),
  char("入"), // Code correct: OH
  char("入"),
  char("夾"), // Fixed code: KOO not OKO
  char("夾"),
  // Practice mix
  char("人"),
  char("个"),
  char("八"),
  char("從"),
  char("入"),
]

// Lesson 16: 心 - Learn P (心) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P
let lesson16Characters = [
  // Introduce 心
  char("心"),
  char("心"),
  char("心"),
  char("心"),
  char("心"),
  // Characters with 心 (A-P available)
  char("必"),
  char("必"),
  char("必"),
  char("必"),
  // Practice mix (removed 忙 and 忍 - use keys not available)
  char("心"),
  char("必"),
  char("心"),
  char("必"),
  char("心"),
  char("心"),
]

// Lesson 17: 手 - Learn Q (手) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q
let lesson17Characters = [
  // Introduce 手
  char("手"),
  char("手"),
  char("手"),
  char("手"),
  char("手"),
  // Characters with 手 (A-Q available)
  char("拜"), // Fixed code: HQMQJ not QJD
  char("拜"),
  char("打"), // Fixed code: QMN not QJ
  char("打"),
  char("打"),
  char("打"),
  // Practice mix (removed 拾 - uses R not available)
  char("手"),
  char("拜"),
  char("打"),
  char("手"),
  char("打"),
  char("手"),
]

// Lesson 18: 口 - Learn R (口) - Can only use: A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R
let lesson18Characters = [
  // Introduce 口
  char("口"),
  char("口"),
  char("口"),
  char("口"),
  char("口"),
  // Characters with 口 (A-R available)
  char("石"),
  char("石"),
  char("呆"),
  char("呆"),
  char("右"),
  char("右"),
  char("扣"),
  char("扣"),
  char("同"),
  char("同"),
  char("古"),
  char("古"), // Fixed: JR not RJR
  char("可"),
  char("可"),
  // Practice mix
  char("口"),
  char("右"),
  char("扣"),
  char("同"),
  char("古"),
]

// CHARACTER SHAPES (字形類) - Lessons 19-24
// Lesson 19: 尸 - Learn S (尸) - Can only use: A-S
let lesson19Characters = [
  // Introduce 尸
  char("尸"),
  char("尸"),
  char("尸"),
  char("尸"),
  char("尸"),
  // Characters with 尸 (A-S available)
  char("尺"),
  char("尺"),
  char("尼"),
  char("尼"),
  char("局"),
  char("局"),
  // Practice mix (removed 尾 - uses U not available)
  char("尸"),
  char("尺"),
  char("尼"),
  char("局"),
]

// Lesson 20: 廿 - Learn T (廿) - Can only use: A-T
let lesson20Characters = [
  // Introduce 廿
  char("廿"),
  char("廿"),
  char("廿"),
  char("廿"),
  char("廿"),
  // Characters with 廿 (A-T available)
  char("卅"),
  char("卅"),
  char("草"),
  char("草"),
  char("若"),
  char("若"),
  char("共"),
  char("共"),
  char("廿"),
  char("廿"),
  // Practice mix
  char("廿"),
  char("卅"),
  char("草"),
  char("若"),
  char("共"),
]

// Lesson 21: 山 - Learn U (山) - Can only use: A-U
let lesson21Characters = [
  // Introduce 山
  char("山"),
  char("山"),
  char("山"),
  char("山"),
  char("山"),
  // Characters with 山 (A-U available)
  char("出"),
  char("出"),
  char("出"),
  char("岐"),
  char("岐"),
  char("屯"),
  char("屯"),
  // Practice mix
  char("山"),
  char("出"),
  char("岐"),
  char("山"),
  char("屯"),
  char("山"),
]

// Lesson 22: 女 - Learn V (女) - Can only use: A-V
let lesson22Characters = [
  // Introduce 女
  char("女"),
  char("女"),
  char("女"),
  char("女"),
  char("女"),
  // Characters with 女 (A-V available)
  char("好"),
  char("好"),
  char("好"),
  char("如"),
  char("如"),
  char("妃"),
  char("妃"),
  // Practice mix
  char("女"),
  char("好"),
  char("如"),
  char("女"),
  char("妃"),
  char("女"),
]

// Lesson 23: 田 - Learn W (田) - Can only use: A-W
let lesson23Characters = [
  // Introduce 田
  char("田"),
  char("田"),
  char("田"),
  char("田"),
  char("田"),
  // Characters with 田 (A-W available)
  char("東"),
  char("東"),
  char("由"),
  char("由"),
  char("甲"),
  char("甲"),
  char("男"),
  char("男"),
  // Practice mix
  char("田"),
  char("東"),
  char("由"),
  char("甲"),
  char("田"),
  char("男"),
]

// Lesson 24: 卜 - Learn Y (卜) - Can only use: A-Y
let lesson24Characters = [
  // Introduce 卜
  char("卜"),
  char("卜"),
  char("卜"),
  char("卜"),
  char("卜"),
  // Characters with 卜 (A-Y available)
  char("上"),
  char("上"),
  char("占"),
  char("占"),
  char("下"),
  char("下"),
  char("外"),
  char("外"),
  char("卡"),
  char("卡"),
  // Practice mix
  char("卜"),
  char("上"),
  char("占"),
  char("下"),
  char("外"),
  char("卡"),
]

// SPECIAL KEYS (特殊鍵) - Lessons 25-26
// Lesson 25: 難 - Learn X (難)
let lesson25Characters = [
  // X is used for difficult/special characters
  char("卵"),
  char("卵"),
  char("巢"),
  char("巢"),
  char("鹿"),
  char("鹿"),
  // Practice mix
  char("卵"),
  char("巢"),
  char("鹿"),
  char("卵"),
]

// Lesson 26: 重 - Learn Z (重)
let lesson26Characters = [
  // Z is the repeat key - used when a shape repeats
  char("昌"),
  char("昌"),
  char("朋"),
  char("朋"),
  char("林"),
  char("林"),
  char("炎"),
  char("炎"),
  char("從"),
  char("從"),
  char("出"),
  char("出"),
]

// Application lessons - multi-character words using learned radicals

// Philosophy Application: Only uses A-G (日月金木水火土)
let philosophyApplicationCharacters = [
  // Practice double radicals
  char("明"), // bright/tomorrow
  char("昌"), // prosperous
  char("朋"), // friend
  char("林"), // forest
  char("炎"), // flame/inflammation
  char("汉"), // Han Chinese
  // More combinations with A-G only
  char("杜"), // Du (surname), prevent
  char("杲"), // bright (archaic) - Fixed: AD not DA
  char("杳"), // dark/obscure
  char("焚"), // burn
  // Removed characters that use keys beyond A-G:
  // 柏 (DHA uses H), 析 (DHML uses H,M,L), 枝 (DJE uses J),
  // 杏 (DR uses R), 朴 (DY uses Y), 灿 (FU uses U)
  // Mix practice - reinforce the basics
  char("明"),
  char("林"),
  char("炎"),
  char("汉"),
  char("朋"),
  char("昌"),
  char("杜"),
  char("杲"),
  char("杳"),
]

// Strokes Application: Only uses A-N (日月金木水火土竹戈十大中一弓)
let strokesApplicationCharacters = [
  char("早"), // early/morning
  char("末"), // end
  char("友"), // friend
  char("炎"), // flame
  char("汉"), // Han
  char("灰"), // ash/grey
  char("支"), // support/branch
  char("去"), // go
  char("公"), // public
  char("白"), // white
  char("千"), // thousand
  char("禾"), // grain/rice
  char("少"), // few/little
  char("寸"), // inch
  char("引"), // pull/guide
  char("弱"), // weak
  char("天"), // sky/heaven
  char("旦"), // dawn
  char("成"), // become
  char("有"), // have
]

// Body Parts Application: Only uses A-R (all previous + 人心手口)
let bodyPartsApplicationCharacters = [
  char("同"), // same
  char("右"), // right
  char("石"), // stone
  char("呆"), // dull/stay
  char("个"), // MW/individual
  char("八"), // eight
  char("從"), // from/follow
  char("必"), // must
  char("扣"), // button/knock
]

// Shapes Application: Only uses A-Y (all previous + 尸廿山女田卜)
let shapesApplicationCharacters = [
  char("早"), // early
  char("白"), // white
  char("同"), // same
  char("出"), // out/exit
  char("好"), // good
  char("上"), // up/above
  char("下"), // down/below
  char("占"), // occupy/divine
  char("若"), // if/like
  char("草"), // grass
  char("東"), // east
  char("由"), // by/from
]

// PATTERN EXPLORATION - Teach character decomposition and structure
// These lessons bridge from radical learning to common characters
// Focus: How keys represent different components in actual characters

// Lesson 26: Simple Two-Key Combinations
// Introduction to how two radicals combine to form characters
let simplePatternCharacters = [
  // Double radicals (same key twice)
  char("明"), // bright: sun + moon
  char("明"),
  char("林"), // forest: two trees
  char("林"),
  char("炎"), // flame: two fires
  char("炎"),

  // Simple left-right combinations
  char("好"), // good: woman + child
  char("好"),
  char("如"), // if: woman + mouth
  char("如"),
  char("杜"), // surname Du: wood + earth
  char("杜"),

  // Top-bottom combinations
  char("早"), // early: sun over ten
  char("早"),
  char("草"), // grass: grass radical + early
  char("草"),

  // Mix practice
  char("明"),
  char("林"),
  char("好"),
  char("早"),
]

// Lesson 27: Three-Key Character Patterns
// Characters requiring three inputs - more complex decomposition
let threeKeyPatternCharacters = [
  // Three components arranged vertically
  char("草"), // grass
  char("草"),
  char("若"), // if/like
  char("若"),

  // Three components arranged horizontally and vertically
  char("男"), // male: field + strength
  char("男"),
  char("字"), // character
  char("字"),

  // Three keys with meaning
  char("共"), // together
  char("共"),
  char("石"), // stone
  char("石"),
  char("古"), // ancient
  char("古"),

  // Mix practice
  char("草"),
  char("男"),
  char("字"),
  char("古"),
]

// Lesson 28: Enclosures and Special Structures
// Understanding outside→inside, left→right rules for enclosed structures
let enclosurePatternCharacters = [
  // Full enclosures (type outside first)
  char("回"), // return: enclosure + mouth
  char("回"),
  char("因"), // because: enclosure + big
  char("因"),
  char("困"), // difficult: enclosure + wood
  char("困"),

  // Partial enclosures
  char("同"), // same: enclosure with opening
  char("同"),

  // Complex enclosed structures
  makeChar("日", "A", None, ()), // sun (single key, full enclosure)
  makeChar("日", "A", None, ()),
  makeChar("月", "B", None, ()), // moon (single key)
  makeChar("月", "B", None, ()),
  makeChar("田", "W", None, ()), // field (single key, grid structure)
  makeChar("田", "W", None, ()),

  // Top-to-bottom with enclosure
  char("早"), // early: sun over ten
  char("早"),

  // Mix practice
  char("回"),
  char("因"),
  char("同"),
  char("早"),
]

// Lesson 29: Mixed Pattern Practice
// Comprehensive review of all pattern types
let mixedPatternCharacters = [
  // Review all patterns learned
  char("明"), // double radicals
  char("林"),
  char("炎"),

  char("好"), // left-right
  char("如"),
  char("杜"),

  char("早"), // top-bottom
  char("草"),

  char("男"), // three-key patterns
  char("字"),
  char("古"),

  char("回"), // enclosures
  char("因"),
  char("困"),
  char("同"),

  // Final mix
  char("明"),
  char("好"),
  char("草"),
  char("回"),
]

// Lesson 30: Four-Key Complex Patterns
// Characters with 4 keys showing various structural combinations
let fourKeyPatternCharacters = [
  // Four keys: complex left-right structures
  char("謝"), // thanks: speech + body
  char("謝"),
  char("請"), // please: speech + invite
  char("請"),
  char("課"), // lesson: speech + fruit
  char("課"),

  // Four keys: complex top-bottom structures
  char("思"), // think: field + heart
  char("思"),
  char("意"), // meaning: sound + heart
  char("意"),
  char("愛"), // love: claw + heart + walk
  char("愛"),

  // Four keys: enclosed structures
  char("國"), // country: enclosure + jade
  char("國"),
  char("園"), // garden: enclosure + yuan
  char("園"),

  // Mix practice
  char("謝"),
  char("思"),
  char("國"),
  char("意"),
]

// Lesson 31: Five-Key Maximum Complexity
// The most complex characters use all 5 keys (first-second-third-last rule)
let fiveKeyPatternCharacters = [
  // Understanding the first-last rule for complex characters
  char("樹"), // tree: wood + bean + inch
  char("樹"),
  char("樂"), // music/joy: white + wood
  char("樂"),
  char("藥"), // medicine: grass + music
  char("藥"),

  // Five key characters with complex radicals
  char("機"), // machine: wood + chance
  char("機"),
  char("橋"), // bridge: wood + high
  char("橋"),
  char("權"), // power/right: wood + authority
  char("權"),

  // Characters showing first-second-third-last selection
  char("難"), // difficult: many components
  char("難"),
  char("變"), // change: complex structure
  char("變"),

  // Mix practice
  char("樹"),
  char("藥"),
  char("難"),
  char("機"),
]

// Lesson 32: Connected vs Disconnected Components
// Understanding when strokes are considered connected or separate
let connectedComponentsCharacters = [
  // Connected components count as one radical
  char("木"), // wood: connected strokes
  char("木"),
  char("林"), // forest: two separate woods
  char("林"),
  char("日"), // sun: connected enclosure
  char("日"),

  // Disconnected components are separate radicals
  char("八"), // eight: two separated strokes
  char("八"),
  char("小"), // small: disconnected vertical + dots
  char("小"),
  char("川"), // river: three separate strokes
  char("川"),

  // Characters where connection matters
  char("口"), // mouth: connected enclosure (1 key)
  char("口"),
  char("人"), // person: connected strokes (1 key)
  char("人"),
  char("個"), // individual: person + solid
  char("個"),

  // Mix practice
  char("林"),
  char("八"),
  char("川"),
  char("個"),
]

// Lesson 33: First-Last Rule Deep Dive
// Understanding how to handle characters with many components
let firstLastRuleCharacters = [
  // Two components: take all keys
  char("明"), // 2 components: both keys
  char("明"),
  char("林"), // 2 components: both keys
  char("林"),

  // Three components: take all keys
  char("草"), // 3 components: all keys
  char("草"),
  char("思"), // 2 components: field + heart
  char("思"),

  // Five+ strokes: first, second, third, last
  char("難"), // many strokes: 1st,2nd,3rd,last
  char("難"),
  char("贏"), // win: complex character
  char("贏"),

  // Understanding which strokes to count
  char("爾"), // you (formal): many parts
  char("爾"),
  char("華"), // magnificent: flower radical
  char("華"),

  // Practice characters showing the rule
  char("義"), // righteousness/meaning
  char("義"),
  char("羣"), // group (variant)
  char("羣"),

  // Mix practice
  char("難"),
  char("贏"),
  char("華"),
  char("義"),
]

// Lesson 34: Radical Variations
// Same radical appears differently based on position
let radicalVariationCharacters = [
  // 人 (O) vs 亻(O) - person radical in different positions
  char("人"), // person standalone
  char("人"),
  char("你"), // you: person + you
  char("你"),
  char("他"), // he: person + also
  char("他"),

  // 水 (E) vs 氵(E) - water radical variations
  char("水"), // water standalone
  char("水"),
  char("河"), // river: water + can
  char("河"),
  char("江"), // river: water + work
  char("江"),

  // 心 (P) vs 忄(P) vs ⺗(P) - heart radical variations
  char("心"), // heart standalone
  char("心"),
  char("怕"), // fear: heart + white
  char("怕"),
  char("思"), // think: heart at bottom
  char("思"),

  // 手 (Q) vs 扌(Q) - hand radical variations
  char("手"), // hand standalone
  char("手"),
  char("打"), // hit: hand + nail
  char("打"),
  char("拿"), // take: hand + together
  char("拿"),

  // Mix practice
  char("你"),
  char("河"),
  char("思"),
  char("打"),
]

// Lesson 35: Exception Characters and Special Cases
// Characters that don't follow obvious patterns - learn by memory
let exceptionCharacters = [
  // Common exceptions that trip up learners
  char("必"), // must: heart + stroke (not obvious)
  char("必"),
  char("世"), // world: unusual decomposition
  char("世"),
  char("或"), // or: complex breakdown
  char("或"),

  // Characters where radical isn't obvious
  char("重"), // heavy/repeat: not intuitive
  char("重"),
  char("書"), // book: special form
  char("書"),
  char("車"), // car/vehicle: symmetrical
  char("車"),

  // Simplified vs traditional differences
  char("學"), // study: complex traditional
  char("學"),
  char("愛"), // love: has claw + heart
  char("愛"),

  // Characters with hidden components
  char("為"), // for/do: hand + elephant
  char("為"),
  char("與"), // give/and: unusual
  char("與"),

  // Mix practice - memorize these!
  char("必"),
  char("重"),
  char("學"),
  char("為"),
]

// Lesson 36: Comprehensive Pattern Review
// Mix all patterns learned in lessons 26-35
let comprehensivePatternReview = [
  // Simple patterns (Lesson 26-27)
  makeChar("明", "AB", Some(["日", "月"]), ()),
  makeChar("林", "DD", Some(["木", "木"]), ()),
  makeChar("草", "TAJ", Some(["廿", "日", "十"]), ()),
  makeChar("字", "JND", Some(["十", "弓", "木"]), ()),

  // Enclosures (Lesson 28)
  makeChar("回", "WR", Some(["田", "口"]), ()),
  makeChar("因", "WK", Some(["田", "大"]), ()),
  makeChar("同", "BMR", Some(["月", "一", "口"]), ()),

  // Four-key patterns (Lesson 30)
  makeChar("謝", "YRHHI", Some(["卜", "口", "竹", "竹", "戈"]), ()),
  makeChar("思", "WP", Some(["田", "心"]), ()),
  makeChar("國", "WIRM", Some(["田", "戈", "口", "一"]), ()),

  // Five-key complexity (Lesson 31)
  makeChar("難", "TOOG", Some(["廿", "人", "人", "土"]), ()),
  makeChar("樹", "DGTI", Some(["木", "土", "廿", "戈"]), ()),

  // Connected components (Lesson 32)
  makeChar("八", "HO", Some(["竹", "人"]), ()),
  makeChar("川", "LLL", Some(["中", "中", "中"]), ()),

  // First-last rule (Lesson 33)
  makeChar("贏", "YNBUC", Some(["卜", "弓", "月", "山", "金"]), ()),
  makeChar("華", "TMTJ", Some(["廿", "一", "廿", "十"]), ()),

  // Radical variations (Lesson 34)
  makeChar("你", "ONF", Some(["人", "弓", "火"]), ()),
  makeChar("河", "EMNR", Some(["水", "一", "弓", "口"]), ()),
  makeChar("打", "QMN", Some(["手", "一", "弓"]), ()),

  // Exceptions (Lesson 35)
  makeChar("必", "PH", Some(["心", "竹"]), ()),
  makeChar("重", "HJWG", Some(["竹", "十", "田", "土"]), ()),
  makeChar("學", "HBND", Some(["竹", "月", "弓", "木"]), ()),

  // Final comprehensive mix
  makeChar("明", "AB", Some(["日", "月"]), ()),
  makeChar("國", "WIRM", Some(["田", "戈", "口", "一"]), ()),
  makeChar("難", "TOOG", Some(["廿", "人", "人", "土"]), ()),
  makeChar("思", "WP", Some(["田", "心"]), ()),
  makeChar("為", "IKNF", Some(["戈", "大", "弓", "火"]), ()),
]

// Top 100 Most Common Characters - Advanced Lessons
// Each lesson: 5 characters, each repeated 3-4 times for practice

// SET 1: Characters 1-20 (的一是不了 + 人我在有他 + 這為之大來 + 以個中上們)
let commonChars1 = [  // 的一是不了
  makeChar("的", "HAPI", None, ~frequencyRank=1, ()),
  makeChar("的", "HAPI", None, ~frequencyRank=1, ()),
  makeChar("的", "HAPI", None, ~frequencyRank=1, ()),
  makeChar("一", "M", None, ~frequencyRank=2, ()),
  makeChar("一", "M", None, ~frequencyRank=2, ()),
  makeChar("一", "M", None, ~frequencyRank=2, ()),
  makeChar("是", "AMYO", None, ~frequencyRank=3, ()),
  makeChar("是", "AMYO", None, ~frequencyRank=3, ()),
  makeChar("是", "AMYO", None, ~frequencyRank=3, ()),
  makeChar("不", "MF", None, ~frequencyRank=4, ()),
  makeChar("不", "MF", None, ~frequencyRank=4, ()),
  makeChar("不", "MF", None, ~frequencyRank=4, ()),
  makeChar("了", "NN", None, ~frequencyRank=5, ()),
  makeChar("了", "NN", None, ~frequencyRank=5, ()),
  makeChar("了", "NN", None, ~frequencyRank=5, ()),
  // Mix practice
  makeChar("的", "HAPI", None, ~frequencyRank=1, ()),
  makeChar("一", "M", None, ~frequencyRank=2, ()),
  makeChar("是", "AMYO", None, ~frequencyRank=3, ()),
  makeChar("不", "MF", None, ~frequencyRank=4, ()),
  makeChar("了", "NN", None, ~frequencyRank=5, ()),
]

let commonChars2 = [  // 人我在有他
  makeChar("人", "O", None, ~frequencyRank=6, ()),
  makeChar("人", "O", None, ~frequencyRank=6, ()),
  makeChar("人", "O", None, ~frequencyRank=6, ()),
  makeChar("我", "HQI", None, ~frequencyRank=7, ()),
  makeChar("我", "HQI", None, ~frequencyRank=7, ()),
  makeChar("我", "HQI", None, ~frequencyRank=7, ()),
  makeChar("在", "KLG", None, ~frequencyRank=8, ()),
  makeChar("在", "KLG", None, ~frequencyRank=8, ()),
  makeChar("在", "KLG", None, ~frequencyRank=8, ()),
  makeChar("有", "KB", None, ~frequencyRank=9, ()),
  makeChar("有", "KB", None, ~frequencyRank=9, ()),
  makeChar("有", "KB", None, ~frequencyRank=9, ()),
  makeChar("他", "OPD", None, ~frequencyRank=10, ()),
  makeChar("他", "OPD", None, ~frequencyRank=10, ()),
  makeChar("他", "OPD", None, ~frequencyRank=10, ()),
  // Mix practice
  makeChar("人", "O", None, ~frequencyRank=6, ()),
  makeChar("我", "HQI", None, ~frequencyRank=7, ()),
  makeChar("在", "KLG", None, ~frequencyRank=8, ()),
  makeChar("有", "KB", None, ~frequencyRank=9, ()),
  makeChar("他", "OPD", None, ~frequencyRank=10, ()),
]

let commonChars3 = [  // 這為之大來
  makeChar("這", "YYMR", None, ~frequencyRank=11, ()),
  makeChar("這", "YYMR", None, ~frequencyRank=11, ()),
  makeChar("這", "YYMR", None, ~frequencyRank=11, ()),
  makeChar("為", "IKNF", None, ~frequencyRank=12, ()),
  makeChar("為", "IKNF", None, ~frequencyRank=12, ()),
  makeChar("為", "IKNF", None, ~frequencyRank=12, ()),
  makeChar("之", "INO", None, ~frequencyRank=13, ()),
  makeChar("之", "INO", None, ~frequencyRank=13, ()),
  makeChar("之", "INO", None, ~frequencyRank=13, ()),
  makeChar("大", "K", None, ~frequencyRank=14, ()),
  makeChar("大", "K", None, ~frequencyRank=14, ()),
  makeChar("大", "K", None, ~frequencyRank=14, ()),
  makeChar("來", "DOO", None, ~frequencyRank=15, ()),
  makeChar("來", "DOO", None, ~frequencyRank=15, ()),
  makeChar("來", "DOO", None, ~frequencyRank=15, ()),
  // Mix practice
  makeChar("這", "YYMR", None, ~frequencyRank=11, ()),
  makeChar("為", "IKNF", None, ~frequencyRank=12, ()),
  makeChar("之", "INO", None, ~frequencyRank=13, ()),
  makeChar("大", "K", None, ~frequencyRank=14, ()),
  makeChar("來", "DOO", None, ~frequencyRank=15, ()),
]

let commonChars4 = [  // 以個中上們
  makeChar("以", "VIO", None, ~frequencyRank=16, ()),
  makeChar("以", "VIO", None, ~frequencyRank=16, ()),
  makeChar("以", "VIO", None, ~frequencyRank=16, ()),
  makeChar("個", "OWJR", None, ~frequencyRank=17, ()),
  makeChar("個", "OWJR", None, ~frequencyRank=17, ()),
  makeChar("個", "OWJR", None, ~frequencyRank=17, ()),
  makeChar("中", "L", None, ~frequencyRank=18, ()),
  makeChar("中", "L", None, ~frequencyRank=18, ()),
  makeChar("中", "L", None, ~frequencyRank=18, ()),
  makeChar("上", "YM", None, ~frequencyRank=19, ()),
  makeChar("上", "YM", None, ~frequencyRank=19, ()),
  makeChar("上", "YM", None, ~frequencyRank=19, ()),
  makeChar("們", "OAN", None, ~frequencyRank=20, ()),
  makeChar("們", "OAN", None, ~frequencyRank=20, ()),
  makeChar("們", "OAN", None, ~frequencyRank=20, ()),
  // Mix practice
  makeChar("以", "VIO", None, ~frequencyRank=16, ()),
  makeChar("個", "OWJR", None, ~frequencyRank=17, ()),
  makeChar("中", "L", None, ~frequencyRank=18, ()),
  makeChar("上", "YM", None, ~frequencyRank=19, ()),
  makeChar("們", "OAN", None, ~frequencyRank=20, ()),
]

// SET 2: Characters 21-40
let commonChars5 = [  // 到說國和地
  makeChar("到", "MGLN", None, ~frequencyRank=21, ()),
  makeChar("到", "MGLN", None, ~frequencyRank=21, ()),
  makeChar("到", "MGLN", None, ~frequencyRank=21, ()),
  makeChar("說", "YRCRU", None, ~frequencyRank=22, ()),
  makeChar("說", "YRCRU", None, ~frequencyRank=22, ()),
  makeChar("說", "YRCRU", None, ~frequencyRank=22, ()),
  makeChar("國", "WIRM", None, ~frequencyRank=23, ()),
  makeChar("國", "WIRM", None, ~frequencyRank=23, ()),
  makeChar("國", "WIRM", None, ~frequencyRank=23, ()),
  makeChar("和", "HDR", None, ~frequencyRank=24, ()),
  makeChar("和", "HDR", None, ~frequencyRank=24, ()),
  makeChar("和", "HDR", None, ~frequencyRank=24, ()),
  makeChar("地", "GPD", None, ~frequencyRank=25, ()),
  makeChar("地", "GPD", None, ~frequencyRank=25, ()),
  makeChar("地", "GPD", None, ~frequencyRank=25, ()),
  // Mix practice
  makeChar("到", "MGLN", None, ~frequencyRank=21, ()),
  makeChar("說", "YRCRU", None, ~frequencyRank=22, ()),
  makeChar("國", "WIRM", None, ~frequencyRank=23, ()),
  makeChar("和", "HDR", None, ~frequencyRank=24, ()),
  makeChar("地", "GPD", None, ~frequencyRank=25, ()),
]

let commonChars6 = [  // 也子時道出
  makeChar("也", "PD", None, ~frequencyRank=26, ()),
  makeChar("也", "PD", None, ~frequencyRank=26, ()),
  makeChar("也", "PD", None, ~frequencyRank=26, ()),
  makeChar("子", "ND", None, ~frequencyRank=27, ()),
  makeChar("子", "ND", None, ~frequencyRank=27, ()),
  makeChar("子", "ND", None, ~frequencyRank=27, ()),
  makeChar("時", "AGDI", None, ~frequencyRank=28, ()),
  makeChar("時", "AGDI", None, ~frequencyRank=28, ()),
  makeChar("時", "AGDI", None, ~frequencyRank=28, ()),
  makeChar("道", "YTHU", None, ~frequencyRank=29, ()),
  makeChar("道", "YTHU", None, ~frequencyRank=29, ()),
  makeChar("道", "YTHU", None, ~frequencyRank=29, ()),
  makeChar("出", "UU", None, ~frequencyRank=30, ()),
  makeChar("出", "UU", None, ~frequencyRank=30, ()),
  makeChar("出", "UU", None, ~frequencyRank=30, ()),
  // Mix practice
  makeChar("也", "PD", None, ~frequencyRank=26, ()),
  makeChar("子", "ND", None, ~frequencyRank=27, ()),
  makeChar("時", "AGDI", None, ~frequencyRank=28, ()),
  makeChar("道", "YTHU", None, ~frequencyRank=29, ()),
  makeChar("出", "UU", None, ~frequencyRank=30, ()),
]

let commonChars7 = [  // 而要於就下
  makeChar("而", "MBLL", None, ~frequencyRank=31, ()),
  makeChar("而", "MBLL", None, ~frequencyRank=31, ()),
  makeChar("而", "MBLL", None, ~frequencyRank=31, ()),
  makeChar("要", "MWV", None, ~frequencyRank=32, ()),
  makeChar("要", "MWV", None, ~frequencyRank=32, ()),
  makeChar("要", "MWV", None, ~frequencyRank=32, ()),
  makeChar("於", "YSOY", None, ~frequencyRank=33, ()),
  makeChar("於", "YSOY", None, ~frequencyRank=33, ()),
  makeChar("於", "YSOY", None, ~frequencyRank=33, ()),
  makeChar("就", "YFIKU", None, ~frequencyRank=34, ()),
  makeChar("就", "YFIKU", None, ~frequencyRank=34, ()),
  makeChar("就", "YFIKU", None, ~frequencyRank=34, ()),
  makeChar("下", "MY", None, ~frequencyRank=35, ()),
  makeChar("下", "MY", None, ~frequencyRank=35, ()),
  makeChar("下", "MY", None, ~frequencyRank=35, ()),
  // Mix practice
  makeChar("而", "MBLL", None, ~frequencyRank=31, ()),
  makeChar("要", "MWV", None, ~frequencyRank=32, ()),
  makeChar("於", "YSOY", None, ~frequencyRank=33, ()),
  makeChar("就", "YFIKU", None, ~frequencyRank=34, ()),
  makeChar("下", "MY", None, ~frequencyRank=35, ()),
]

let commonChars8 = [  // 得可你年生
  makeChar("得", "HOAMI", None, ~frequencyRank=36, ()),
  makeChar("得", "HOAMI", None, ~frequencyRank=36, ()),
  makeChar("得", "HOAMI", None, ~frequencyRank=36, ()),
  makeChar("可", "MNR", None, ~frequencyRank=37, ()),
  makeChar("可", "MNR", None, ~frequencyRank=37, ()),
  makeChar("可", "MNR", None, ~frequencyRank=37, ()),
  makeChar("你", "ONF", None, ~frequencyRank=38, ()),
  makeChar("你", "ONF", None, ~frequencyRank=38, ()),
  makeChar("你", "ONF", None, ~frequencyRank=38, ()),
  makeChar("年", "OQ", None, ~frequencyRank=39, ()),
  makeChar("年", "OQ", None, ~frequencyRank=39, ()),
  makeChar("年", "OQ", None, ~frequencyRank=39, ()),
  makeChar("生", "HQM", None, ~frequencyRank=40, ()),
  makeChar("生", "HQM", None, ~frequencyRank=40, ()),
  makeChar("生", "HQM", None, ~frequencyRank=40, ()),
  // Mix practice
  makeChar("得", "HOAMI", None, ~frequencyRank=36, ()),
  makeChar("可", "MNR", None, ~frequencyRank=37, ()),
  makeChar("你", "ONF", None, ~frequencyRank=38, ()),
  makeChar("年", "OQ", None, ~frequencyRank=39, ()),
  makeChar("生", "HQM", None, ~frequencyRank=40, ()),
]

// SET 3: Characters 41-60
let commonChars9 = [  // 自會那後能
  makeChar("自", "HBU", None, ~frequencyRank=41, ()),
  makeChar("自", "HBU", None, ~frequencyRank=41, ()),
  makeChar("自", "HBU", None, ~frequencyRank=41, ()),
  makeChar("會", "OMWA", None, ~frequencyRank=42, ()),
  makeChar("會", "OMWA", None, ~frequencyRank=42, ()),
  makeChar("會", "OMWA", None, ~frequencyRank=42, ()),
  makeChar("那", "SQNL", None, ~frequencyRank=43, ()),
  makeChar("那", "SQNL", None, ~frequencyRank=43, ()),
  makeChar("那", "SQNL", None, ~frequencyRank=43, ()),
  makeChar("後", "HOVIE", None, ~frequencyRank=44, ()),
  makeChar("後", "HOVIE", None, ~frequencyRank=44, ()),
  makeChar("後", "HOVIE", None, ~frequencyRank=44, ()),
  makeChar("能", "IBPP", None, ~frequencyRank=45, ()),
  makeChar("能", "IBPP", None, ~frequencyRank=45, ()),
  makeChar("能", "IBPP", None, ~frequencyRank=45, ()),
  // Mix practice
  makeChar("自", "HBU", None, ~frequencyRank=41, ()),
  makeChar("會", "OMWA", None, ~frequencyRank=42, ()),
  makeChar("那", "SQNL", None, ~frequencyRank=43, ()),
  makeChar("後", "HOVIE", None, ~frequencyRank=44, ()),
  makeChar("能", "IBPP", None, ~frequencyRank=45, ()),
]

let commonChars10 = [  // 對著事其里
  makeChar("對", "TGDI", None, ~frequencyRank=46, ()),
  makeChar("對", "TGDI", None, ~frequencyRank=46, ()),
  makeChar("對", "TGDI", None, ~frequencyRank=46, ()),
  makeChar("著", "TJKA", None, ~frequencyRank=47, ()),
  makeChar("著", "TJKA", None, ~frequencyRank=47, ()),
  makeChar("著", "TJKA", None, ~frequencyRank=47, ()),
  makeChar("事", "JLLN", None, ~frequencyRank=48, ()),
  makeChar("事", "JLLN", None, ~frequencyRank=48, ()),
  makeChar("事", "JLLN", None, ~frequencyRank=48, ()),
  makeChar("其", "TMMC", None, ~frequencyRank=49, ()),
  makeChar("其", "TMMC", None, ~frequencyRank=49, ()),
  makeChar("其", "TMMC", None, ~frequencyRank=49, ()),
  makeChar("里", "WG", None, ~frequencyRank=50, ()),
  makeChar("里", "WG", None, ~frequencyRank=50, ()),
  makeChar("里", "WG", None, ~frequencyRank=50, ()),
  // Mix practice
  makeChar("對", "TGDI", None, ~frequencyRank=46, ()),
  makeChar("著", "TJKA", None, ~frequencyRank=47, ()),
  makeChar("事", "JLLN", None, ~frequencyRank=48, ()),
  makeChar("其", "TMMC", None, ~frequencyRank=49, ()),
  makeChar("里", "WG", None, ~frequencyRank=50, ()),
]

let commonChars11 = [  // 所去行過家
  makeChar("所", "HSHML", None, ~frequencyRank=51, ()),
  makeChar("所", "HSHML", None, ~frequencyRank=51, ()),
  makeChar("所", "HSHML", None, ~frequencyRank=51, ()),
  makeChar("去", "GI", None, ~frequencyRank=52, ()),
  makeChar("去", "GI", None, ~frequencyRank=52, ()),
  makeChar("去", "GI", None, ~frequencyRank=52, ()),
  makeChar("行", "HOMMN", None, ~frequencyRank=53, ()),
  makeChar("行", "HOMMN", None, ~frequencyRank=53, ()),
  makeChar("行", "HOMMN", None, ~frequencyRank=53, ()),
  makeChar("過", "YBBR", None, ~frequencyRank=54, ()),
  makeChar("過", "YBBR", None, ~frequencyRank=54, ()),
  makeChar("過", "YBBR", None, ~frequencyRank=54, ()),
  makeChar("家", "JMSO", None, ~frequencyRank=55, ()),
  makeChar("家", "JMSO", None, ~frequencyRank=55, ()),
  makeChar("家", "JMSO", None, ~frequencyRank=55, ()),
  // Mix practice
  makeChar("所", "HSHML", None, ~frequencyRank=51, ()),
  makeChar("去", "GI", None, ~frequencyRank=52, ()),
  makeChar("行", "HOMMN", None, ~frequencyRank=53, ()),
  makeChar("過", "YBBR", None, ~frequencyRank=54, ()),
  makeChar("家", "JMSO", None, ~frequencyRank=55, ()),
]

let commonChars12 = [  // 十用發天如
  makeChar("十", "J", None, ~frequencyRank=56, ()),
  makeChar("十", "J", None, ~frequencyRank=56, ()),
  makeChar("十", "J", None, ~frequencyRank=56, ()),
  makeChar("用", "BQ", None, ~frequencyRank=57, ()),
  makeChar("用", "BQ", None, ~frequencyRank=57, ()),
  makeChar("用", "BQ", None, ~frequencyRank=57, ()),
  makeChar("發", "NONHE", None, ~frequencyRank=58, ()),
  makeChar("發", "NONHE", None, ~frequencyRank=58, ()),
  makeChar("發", "NONHE", None, ~frequencyRank=58, ()),
  makeChar("天", "MK", None, ~frequencyRank=59, ()),
  makeChar("天", "MK", None, ~frequencyRank=59, ()),
  makeChar("天", "MK", None, ~frequencyRank=59, ()),
  makeChar("如", "VR", None, ~frequencyRank=60, ()),
  makeChar("如", "VR", None, ~frequencyRank=60, ()),
  makeChar("如", "VR", None, ~frequencyRank=60, ()),
  // Mix practice
  makeChar("十", "J", None, ~frequencyRank=56, ()),
  makeChar("用", "BQ", None, ~frequencyRank=57, ()),
  makeChar("發", "NONHE", None, ~frequencyRank=58, ()),
  makeChar("天", "MK", None, ~frequencyRank=59, ()),
  makeChar("如", "VR", None, ~frequencyRank=60, ()),
]

// SET 4: Characters 61-75
let commonChars13 = [  // 然作方成者
  makeChar("然", "BKF", None, ~frequencyRank=61, ()),
  makeChar("然", "BKF", None, ~frequencyRank=61, ()),
  makeChar("然", "BKF", None, ~frequencyRank=61, ()),
  makeChar("作", "OOS", None, ~frequencyRank=62, ()),
  makeChar("作", "OOS", None, ~frequencyRank=62, ()),
  makeChar("作", "OOS", None, ~frequencyRank=62, ()),
  makeChar("方", "YHS", None, ~frequencyRank=63, ()),
  makeChar("方", "YHS", None, ~frequencyRank=63, ()),
  makeChar("方", "YHS", None, ~frequencyRank=63, ()),
  makeChar("成", "IHS", None, ~frequencyRank=64, ()),
  makeChar("成", "IHS", None, ~frequencyRank=64, ()),
  makeChar("成", "IHS", None, ~frequencyRank=64, ()),
  makeChar("者", "JKA", None, ~frequencyRank=65, ()),
  makeChar("者", "JKA", None, ~frequencyRank=65, ()),
  makeChar("者", "JKA", None, ~frequencyRank=65, ()),
  // Mix practice
  makeChar("然", "BKF", None, ~frequencyRank=61, ()),
  makeChar("作", "OOS", None, ~frequencyRank=62, ()),
  makeChar("方", "YHS", None, ~frequencyRank=63, ()),
  makeChar("成", "IHS", None, ~frequencyRank=64, ()),
  makeChar("者", "JKA", None, ~frequencyRank=65, ()),
]

let commonChars14 = [  // 多日都三同
  makeChar("多", "NINI", None, ~frequencyRank=66, ()),
  makeChar("多", "NINI", None, ~frequencyRank=66, ()),
  makeChar("多", "NINI", None, ~frequencyRank=66, ()),
  makeChar("日", "A", None, ~frequencyRank=67, ()),
  makeChar("日", "A", None, ~frequencyRank=67, ()),
  makeChar("日", "A", None, ~frequencyRank=67, ()),
  makeChar("都", "JANL", None, ~frequencyRank=68, ()),
  makeChar("都", "JANL", None, ~frequencyRank=68, ()),
  makeChar("都", "JANL", None, ~frequencyRank=68, ()),
  makeChar("三", "MMM", None, ~frequencyRank=69, ()),
  makeChar("三", "MMM", None, ~frequencyRank=69, ()),
  makeChar("三", "MMM", None, ~frequencyRank=69, ()),
  makeChar("同", "BMR", None, ~frequencyRank=70, ()),
  makeChar("同", "BMR", None, ~frequencyRank=70, ()),
  makeChar("同", "BMR", None, ~frequencyRank=70, ()),
  // Mix practice
  makeChar("多", "NINI", None, ~frequencyRank=66, ()),
  makeChar("日", "A", None, ~frequencyRank=67, ()),
  makeChar("都", "JANL", None, ~frequencyRank=68, ()),
  makeChar("三", "MMM", None, ~frequencyRank=69, ()),
  makeChar("同", "BMR", None, ~frequencyRank=70, ()),
]

let commonChars15 = [  // 已經法當起
  makeChar("已", "SU", None, ~frequencyRank=71, ()),
  makeChar("已", "SU", None, ~frequencyRank=71, ()),
  makeChar("已", "SU", None, ~frequencyRank=71, ()),
  makeChar("經", "VFMVM", None, ~frequencyRank=72, ()),
  makeChar("經", "VFMVM", None, ~frequencyRank=72, ()),
  makeChar("經", "VFMVM", None, ~frequencyRank=72, ()),
  makeChar("法", "EGI", None, ~frequencyRank=73, ()),
  makeChar("法", "EGI", None, ~frequencyRank=73, ()),
  makeChar("法", "EGI", None, ~frequencyRank=73, ()),
  makeChar("當", "FBRW", None, ~frequencyRank=74, ()),
  makeChar("當", "FBRW", None, ~frequencyRank=74, ()),
  makeChar("當", "FBRW", None, ~frequencyRank=74, ()),
  makeChar("起", "GORU", None, ~frequencyRank=75, ()),
  makeChar("起", "GORU", None, ~frequencyRank=75, ()),
  makeChar("起", "GORU", None, ~frequencyRank=75, ()),
  // Mix practice
  makeChar("已", "SU", None, ~frequencyRank=71, ()),
  makeChar("經", "VFMVM", None, ~frequencyRank=72, ()),
  makeChar("法", "EGI", None, ~frequencyRank=73, ()),
  makeChar("當", "FBRW", None, ~frequencyRank=74, ()),
  makeChar("起", "GORU", None, ~frequencyRank=75, ()),
]

// SET 5: Characters 76-90
let commonChars16 = [  // 與好看學進
  makeChar("與", "HXYC", None, ~frequencyRank=76, ()),
  makeChar("與", "HXYC", None, ~frequencyRank=76, ()),
  makeChar("與", "HXYC", None, ~frequencyRank=76, ()),
  makeChar("好", "VND", None, ~frequencyRank=77, ()),
  makeChar("好", "VND", None, ~frequencyRank=77, ()),
  makeChar("好", "VND", None, ~frequencyRank=77, ()),
  makeChar("看", "HQBU", None, ~frequencyRank=78, ()),
  makeChar("看", "HQBU", None, ~frequencyRank=78, ()),
  makeChar("看", "HQBU", None, ~frequencyRank=78, ()),
  makeChar("學", "HBND", None, ~frequencyRank=79, ()),
  makeChar("學", "HBND", None, ~frequencyRank=79, ()),
  makeChar("學", "HBND", None, ~frequencyRank=79, ()),
  makeChar("進", "YOG", None, ~frequencyRank=80, ()),
  makeChar("進", "YOG", None, ~frequencyRank=80, ()),
  makeChar("進", "YOG", None, ~frequencyRank=80, ()),
  // Mix practice
  makeChar("與", "HXYC", None, ~frequencyRank=76, ()),
  makeChar("好", "VND", None, ~frequencyRank=77, ()),
  makeChar("看", "HQBU", None, ~frequencyRank=78, ()),
  makeChar("學", "HBND", None, ~frequencyRank=79, ()),
  makeChar("進", "YOG", None, ~frequencyRank=80, ()),
]

let commonChars17 = [  // 種將還分此
  makeChar("種", "HDHJG", None, ~frequencyRank=81, ()),
  makeChar("種", "HDHJG", None, ~frequencyRank=81, ()),
  makeChar("種", "HDHJG", None, ~frequencyRank=81, ()),
  makeChar("將", "VMBDI", None, ~frequencyRank=82, ()),
  makeChar("將", "VMBDI", None, ~frequencyRank=82, ()),
  makeChar("將", "VMBDI", None, ~frequencyRank=82, ()),
  makeChar("還", "YWLV", None, ~frequencyRank=83, ()),
  makeChar("還", "YWLV", None, ~frequencyRank=83, ()),
  makeChar("還", "YWLV", None, ~frequencyRank=83, ()),
  makeChar("分", "CSH", None, ~frequencyRank=84, ()),
  makeChar("分", "CSH", None, ~frequencyRank=84, ()),
  makeChar("分", "CSH", None, ~frequencyRank=84, ()),
  makeChar("此", "YMP", None, ~frequencyRank=85, ()),
  makeChar("此", "YMP", None, ~frequencyRank=85, ()),
  makeChar("此", "YMP", None, ~frequencyRank=85, ()),
  // Mix practice
  makeChar("種", "HDHJG", None, ~frequencyRank=81, ()),
  makeChar("將", "VMBDI", None, ~frequencyRank=82, ()),
  makeChar("還", "YWLV", None, ~frequencyRank=83, ()),
  makeChar("分", "CSH", None, ~frequencyRank=84, ()),
  makeChar("此", "YMP", None, ~frequencyRank=85, ()),
]

let commonChars18 = [  // 心前面又定
  makeChar("心", "P", None, ~frequencyRank=86, ()),
  makeChar("心", "P", None, ~frequencyRank=86, ()),
  makeChar("心", "P", None, ~frequencyRank=86, ()),
  makeChar("前", "TBLN", None, ~frequencyRank=87, ()),
  makeChar("前", "TBLN", None, ~frequencyRank=87, ()),
  makeChar("前", "TBLN", None, ~frequencyRank=87, ()),
  makeChar("面", "MWSL", None, ~frequencyRank=88, ()),
  makeChar("面", "MWSL", None, ~frequencyRank=88, ()),
  makeChar("面", "MWSL", None, ~frequencyRank=88, ()),
  makeChar("又", "NK", None, ~frequencyRank=89, ()),
  makeChar("又", "NK", None, ~frequencyRank=89, ()),
  makeChar("又", "NK", None, ~frequencyRank=89, ()),
  makeChar("定", "JMYO", None, ~frequencyRank=90, ()),
  makeChar("定", "JMYO", None, ~frequencyRank=90, ()),
  makeChar("定", "JMYO", None, ~frequencyRank=90, ()),
  // Mix practice
  makeChar("心", "P", None, ~frequencyRank=86, ()),
  makeChar("前", "TBLN", None, ~frequencyRank=87, ()),
  makeChar("面", "MWSL", None, ~frequencyRank=88, ()),
  makeChar("又", "NK", None, ~frequencyRank=89, ()),
  makeChar("定", "JMYO", None, ~frequencyRank=90, ()),
]

// SET 6: Characters 91-96 (final set)
let commonChars19 = [  // 見只主沒公從
  makeChar("見", "BUHU", None, ~frequencyRank=91, ()),
  makeChar("見", "BUHU", None, ~frequencyRank=91, ()),
  makeChar("見", "BUHU", None, ~frequencyRank=91, ()),
  makeChar("只", "RC", None, ~frequencyRank=92, ()),
  makeChar("只", "RC", None, ~frequencyRank=92, ()),
  makeChar("只", "RC", None, ~frequencyRank=92, ()),
  makeChar("主", "YG", None, ~frequencyRank=93, ()),
  makeChar("主", "YG", None, ~frequencyRank=93, ()),
  makeChar("主", "YG", None, ~frequencyRank=93, ()),
  makeChar("沒", "ENE", None, ~frequencyRank=94, ()),
  makeChar("沒", "ENE", None, ~frequencyRank=94, ()),
  makeChar("沒", "ENE", None, ~frequencyRank=94, ()),
  makeChar("公", "CI", None, ~frequencyRank=95, ()),
  makeChar("公", "CI", None, ~frequencyRank=95, ()),
  makeChar("公", "CI", None, ~frequencyRank=95, ()),
  makeChar("從", "HOOOO", None, ~frequencyRank=96, ()),
  makeChar("從", "HOOOO", None, ~frequencyRank=96, ()),
  makeChar("從", "HOOOO", None, ~frequencyRank=96, ()),
  // Mix practice - all 6 characters
  makeChar("見", "BUHU", None, ~frequencyRank=91, ()),
  makeChar("只", "RC", None, ~frequencyRank=92, ()),
  makeChar("主", "YG", None, ~frequencyRank=93, ()),
  makeChar("沒", "ENE", None, ~frequencyRank=94, ()),
  makeChar("公", "CI", None, ~frequencyRank=95, ()),
  makeChar("從", "HOOOO", None, ~frequencyRank=96, ()),
]

// Placement test characters (mix of all difficulty levels)
let placementTestChars = [
  makeChar("我", "HQI", None, ()),
  makeChar("你", "ONF", None, ()),
  makeChar("他", "OPD", None, ()),
  makeChar("是", "AMYO", None, ()),
  makeChar("的", "HAPI", None, ()),
  makeChar("了", "NN", None, ()),
  makeChar("在", "KLG", None, ()),
  makeChar("有", "KB", None, ()),
  makeChar("和", "HDR", None, ()),
  makeChar("到", "MGLN", None, ()),
  makeChar("說", "YRCRU", None, ()),
  makeChar("要", "MWV", None, ()),
  makeChar("會", "OMWA", None, ()),
  makeChar("能", "IBPP", None, ()),
  makeChar("出", "UU", None, ()),
]

// Generate all lessons
let getAllLessons = (): array<lesson> => {
  let basicRadicalLessons = [
    // SECTION 1: PHILOSOPHY (哲理類) - Lessons 1-6
    // Lesson 1: 日月
    makeLesson(1, "哲理 1：日月", "學習 A(日) 和 B(月)",
      Philosophy, Radicals, Practice, [A, B],
      Js.Array2.concat(lesson1Characters, lesson2Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 2: 金木
    makeLesson(2, "哲理 2：金木", "學習 C(金) 和 D(木)",
      Philosophy, Radicals, Practice, [C, D],
      Js.Array2.concat(lesson3Characters, lesson4Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 3: 水火
    makeLesson(3, "哲理 3：水火", "學習 E(水) 和 F(火)",
      Philosophy, Radicals, Practice, [E, F],
      Js.Array2.concat(lesson5Characters, lesson6Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 4: 土
    makeLesson(4, "哲理 4：土", "學習 G(土)",
      Philosophy, Radicals, Practice, [G], lesson7Characters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 5: Review
    makeLesson(5, "哲理複習", "複習哲理類所有部首",
      Philosophy, Radicals, Review, [A, B, C, D, E, F, G],
      Js.Array2.concat(
        Js.Array2.concat(lesson1Characters, lesson2Characters),
        Js.Array2.concat(
          Js.Array2.concat(lesson3Characters, lesson4Characters),
          Js.Array2.concat(
            Js.Array2.concat(lesson5Characters, lesson6Characters),
            lesson7Characters
          )
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[1, 2, 3, 4], ()),

    // Lesson 6: Comprehensive Review
    makeLesson(6, "哲理綜合", "綜合練習哲理類應用",
      Philosophy, Radicals, MixedReview, [A, B, C, D, E, F, G],
      Js.Array2.concat(
        Js.Array2.concat(
          Js.Array2.concat(lesson1Characters, lesson2Characters),
          Js.Array2.concat(
            Js.Array2.concat(lesson3Characters, lesson4Characters),
            Js.Array2.concat(
              Js.Array2.concat(lesson5Characters, lesson6Characters),
              lesson7Characters
            )
          )
        ),
        philosophyApplicationCharacters
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[1, 2, 3, 4], ()),

    // SECTION 2: STROKES (筆畫類) - Lessons 7-12
    // Lesson 7: 竹戈
    makeLesson(7, "筆畫 1：竹戈", "學習 H(竹) 和 I(戈)",
      Strokes, Radicals, Practice, [H, I],
      Js.Array2.concat(lesson8Characters, lesson9Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 8: 十大
    makeLesson(8, "筆畫 2：十大", "學習 J(十) 和 K(大)",
      Strokes, Radicals, Practice, [J, K],
      Js.Array2.concat(lesson10Characters, lesson11Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 9: 中一
    makeLesson(9, "筆畫 3：中一", "學習 L(中) 和 M(一)",
      Strokes, Radicals, Practice, [L, M],
      Js.Array2.concat(lesson12Characters, lesson13Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 10: 弓
    makeLesson(10, "筆畫 4：弓", "學習 N(弓)",
      Strokes, Radicals, Practice, [N], lesson14Characters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 11: Review
    makeLesson(11, "筆畫複習", "複習筆畫類所有部首",
      Strokes, Radicals, Review, [H, I, J, K, L, M, N],
      Js.Array2.concat(
        Js.Array2.concat(lesson8Characters, lesson9Characters),
        Js.Array2.concat(
          Js.Array2.concat(lesson10Characters, lesson11Characters),
          Js.Array2.concat(
            Js.Array2.concat(lesson12Characters, lesson13Characters),
            lesson14Characters
          )
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[7, 8, 9, 10], ()),

    // Lesson 12: Comprehensive Review
    makeLesson(12, "筆畫綜合", "綜合練習筆畫類應用",
      Strokes, Radicals, MixedReview, [H, I, J, K, L, M, N],
      Js.Array2.concat(
        Js.Array2.concat(
          Js.Array2.concat(lesson8Characters, lesson9Characters),
          Js.Array2.concat(
            Js.Array2.concat(lesson10Characters, lesson11Characters),
            Js.Array2.concat(
              Js.Array2.concat(lesson12Characters, lesson13Characters),
              lesson14Characters
            )
          )
        ),
        strokesApplicationCharacters
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[7, 8, 9, 10], ()),

    // SECTION 3: BODY PARTS (人體類) - Lessons 13-16
    // Lesson 13: 人心
    makeLesson(13, "人體 1：人心", "學習 O(人) 和 P(心)",
      BodyParts, Radicals, Practice, [O, P],
      Js.Array2.concat(lesson15Characters, lesson16Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 14: 手口
    makeLesson(14, "人體 2：手口", "學習 Q(手) 和 R(口)",
      BodyParts, Radicals, Practice, [Q, R],
      Js.Array2.concat(lesson17Characters, lesson18Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 15: Review
    makeLesson(15, "人體複習", "複習人體類所有部首",
      BodyParts, Radicals, Review, [O, P, Q, R],
      Js.Array2.concat(
        Js.Array2.concat(lesson15Characters, lesson16Characters),
        Js.Array2.concat(lesson17Characters, lesson18Characters)
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[13, 14], ()),

    // Lesson 16: Comprehensive Review
    makeLesson(16, "人體綜合", "綜合練習人體類應用",
      BodyParts, Radicals, MixedReview, [O, P, Q, R],
      Js.Array2.concat(
        Js.Array2.concat(
          Js.Array2.concat(lesson15Characters, lesson16Characters),
          Js.Array2.concat(lesson17Characters, lesson18Characters)
        ),
        bodyPartsApplicationCharacters
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[13, 14], ()),

    // SECTION 4: CHARACTER SHAPES (字形類) - Lessons 17-21
    // Lesson 17: 尸廿
    makeLesson(17, "字形 1：尸廿", "學習 S(尸) 和 T(廿)",
      CharacterShapes, Radicals, Practice, [S, T],
      Js.Array2.concat(lesson19Characters, lesson20Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 18: 山女
    makeLesson(18, "字形 2：山女", "學習 U(山) 和 V(女)",
      CharacterShapes, Radicals, Practice, [U, V],
      Js.Array2.concat(lesson21Characters, lesson22Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 19: 田卜
    makeLesson(19, "字形 3：田卜", "學習 W(田) 和 Y(卜)",
      CharacterShapes, Radicals, Practice, [W, Y],
      Js.Array2.concat(lesson23Characters, lesson24Characters), ~showCode=false, ~allowHints=true, ()),

    // Lesson 20: Review
    makeLesson(20, "字形複習", "複習字形類所有部首",
      CharacterShapes, Radicals, Review, [S, T, U, V, W, Y],
      Js.Array2.concat(
        Js.Array2.concat(lesson19Characters, lesson20Characters),
        Js.Array2.concat(
          Js.Array2.concat(lesson21Characters, lesson22Characters),
          Js.Array2.concat(lesson23Characters, lesson24Characters)
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[17, 18, 19], ()),

    // Lesson 21: Comprehensive Review
    makeLesson(21, "字形綜合", "綜合練習字形類應用",
      CharacterShapes, Radicals, MixedReview, [S, T, U, V, W, Y],
      Js.Array2.concat(
        Js.Array2.concat(
          Js.Array2.concat(lesson19Characters, lesson20Characters),
          Js.Array2.concat(
            Js.Array2.concat(lesson21Characters, lesson22Characters),
            Js.Array2.concat(lesson23Characters, lesson24Characters)
          )
        ),
        shapesApplicationCharacters
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[17, 18, 19], ()),

    // SECTION 5: SPECIAL KEYS (特殊鍵) - Lessons 22-25
    // Lesson 22: 難
    makeLesson(22, "特殊鍵 1：難", "學習 X(難)",
      Advanced, Radicals, Practice, [X], lesson25Characters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 23: 重
    makeLesson(23, "特殊鍵 2：重", "學習重複鍵的使用",
      Advanced, Radicals, Practice, [Z], lesson26Characters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 24: Review
    makeLesson(24, "特殊鍵複習", "複習特殊鍵",
      Advanced, Radicals, Review, [X, Z],
      Js.Array2.concat(lesson25Characters, lesson26Characters),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[22, 23], ()),

    // Lesson 25: Comprehensive Review - All radicals
    makeLesson(25, "特殊鍵綜合", "綜合複習所有基礎部首",
      Advanced, Radicals, MixedReview, [A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, Y, X, Z],
      Js.Array2.concat(lesson25Characters, lesson26Characters),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24], ()),

    // SECTION 5.5: PATTERN EXPLORATION (拆字探索) - Lessons 26-29
    // Bridge between radical learning and common characters
    // Focus: Character decomposition patterns and structural understanding

    // Lesson 26: Simple Two-Key Combinations
    makeLesson(26, "拆字探索 1：簡單組合", "學習雙部首組字規則",
      Advanced, CommonWords, Practice, [],
      simplePatternCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 27: Three-Key Character Patterns
    makeLesson(27, "拆字探索 2：三鍵字型", "學習三部首組字規則",
      Advanced, CommonWords, Practice, [],
      threeKeyPatternCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 28: Enclosures and Special Structures
    makeLesson(28, "拆字探索 3：包圍結構", "學習包圍結構的拆字規則",
      Advanced, CommonWords, Practice, [],
      enclosurePatternCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 29: Mixed Pattern Practice
    makeLesson(29, "拆字探索 4：綜合練習", "綜合複習所有拆字規則",
      Advanced, CommonWords, MixedReview, [],
      mixedPatternCharacters, ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[26, 27, 28], ()),

    // Lesson 30: Four-Key Complex Patterns
    makeLesson(30, "拆字探索 5：四鍵複合", "學習四鍵複雜字型結構",
      Advanced, CommonWords, Practice, [],
      fourKeyPatternCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 31: Five-Key Maximum Complexity
    makeLesson(31, "拆字探索 6：五鍵最複雜", "掌握五鍵最複雜字型與首尾規則",
      Advanced, CommonWords, Practice, [],
      fiveKeyPatternCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 32: Connected vs Disconnected Components
    makeLesson(32, "拆字探索 7：連接與分離", "理解筆畫連接與分離的判斷",
      Advanced, CommonWords, Practice, [],
      connectedComponentsCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 33: First-Last Rule Deep Dive
    makeLesson(33, "拆字探索 8：首尾規則深入", "深入學習處理多部件字的方法",
      Advanced, CommonWords, Practice, [],
      firstLastRuleCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 34: Radical Variations
    makeLesson(34, "拆字探索 9：部首變形", "理解部首在不同位置的變化",
      Advanced, CommonWords, Practice, [],
      radicalVariationCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 35: Exception Characters
    makeLesson(35, "拆字探索 10：特殊例外字", "記憶不遵循常規的特殊字",
      Advanced, CommonWords, Practice, [],
      exceptionCharacters, ~showCode=false, ~allowHints=true, ()),

    // Lesson 36: Comprehensive Pattern Review
    makeLesson(36, "拆字探索 11：全面複習", "全面複習26-35課所有拆字規則",
      Advanced, CommonWords, MixedReview, [],
      comprehensivePatternReview, ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[26, 27, 28, 29, 30, 31, 32, 33, 34, 35], ()),
  ]

  // SECTION 6: TOP COMMON (前100個字) - Lessons 37-onwards
  // Pattern: 3-4 content lessons → review → comprehensive review

  let commonCharLessons = [
    // SET 1: Lessons 37-42 (Characters 1-20)
    makeLesson(37, "常用字（一）：的一是不了", "學習最常用的五個字",
      TopCommon, CommonWords, Practice, [], commonChars1, ~showCode=false, ~allowHints=true, ()),
    makeLesson(38, "常用字（二）：人我在有他", "學習常用代詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars2, ~showCode=false, ~allowHints=true, ()),
    makeLesson(39, "常用字（三）：這為之大來", "學習常用連詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars3, ~showCode=false, ~allowHints=true, ()),
    makeLesson(40, "常用字（四）：以個中上們", "學習常用介詞和量詞",
      TopCommon, CommonWords, Practice, [], commonChars4, ~showCode=false, ~allowHints=true, ()),
    makeLesson(41, "複習：字符 1-20", "複習第三十七到四十課的常用字",
      TopCommon, CommonWords, Review, [],
      Js.Array2.concat(commonChars1, Js.Array2.concat(commonChars2, Js.Array2.concat(commonChars3, commonChars4))),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[37, 38, 39, 40], ()),
    makeLesson(42, "綜合複習：字符 1-20", "隨機複習所有已學常用字",
      TopCommon, CommonWords, MixedReview, [],
      CangjieUtils.shuffleArray(Js.Array2.concat(commonChars1, Js.Array2.concat(commonChars2, Js.Array2.concat(commonChars3, commonChars4)))),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[37, 38, 39, 40], ()),

    // SET 2: Lessons 43-48 (Characters 21-40)
    makeLesson(43, "常用字（五）：到說國和地", "學習常用動詞和名詞",
      TopCommon, CommonWords, Practice, [], commonChars5, ~showCode=false, ~allowHints=true, ()),
    makeLesson(44, "常用字（六）：也子時道出", "學習常用副詞和時間詞",
      TopCommon, CommonWords, Practice, [], commonChars6, ~showCode=false, ~allowHints=true, ()),
    makeLesson(45, "常用字（七）：而要於就下", "學習常用連詞和方位詞",
      TopCommon, CommonWords, Practice, [], commonChars7, ~showCode=false, ~allowHints=true, ()),
    makeLesson(46, "常用字（八）：得可你年生", "學習常用動詞和名詞",
      TopCommon, CommonWords, Practice, [], commonChars8, ~showCode=false, ~allowHints=true, ()),
    makeLesson(47, "複習：字符 21-40", "複習第四十三到四十六課的常用字",
      TopCommon, CommonWords, Review, [],
      Js.Array2.concat(commonChars5, Js.Array2.concat(commonChars6, Js.Array2.concat(commonChars7, commonChars8))),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[43, 44, 45, 46], ()),
    makeLesson(48, "綜合複習：字符 1-40", "隨機複習所有已學常用字",
      TopCommon, CommonWords, MixedReview, [],
      CangjieUtils.shuffleArray(
        Js.Array2.concat(
          Js.Array2.concat(commonChars1, Js.Array2.concat(commonChars2, Js.Array2.concat(commonChars3, commonChars4))),
          Js.Array2.concat(commonChars5, Js.Array2.concat(commonChars6, Js.Array2.concat(commonChars7, commonChars8)))
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[37, 38, 39, 40, 43, 44, 45, 46], ()),

    // SET 3: Lessons 49-54 (Characters 41-60)
    makeLesson(49, "常用字（九）：自會那後能", "學習常用代詞和助動詞",
      TopCommon, CommonWords, Practice, [], commonChars9, ~showCode=false, ~allowHints=true, ()),
    makeLesson(50, "常用字（十）：對著事其里", "學習常用動詞和名詞",
      TopCommon, CommonWords, Practice, [], commonChars10, ~showCode=false, ~allowHints=true, ()),
    makeLesson(51, "常用字（十一）：所去行過家", "學習常用動詞和名詞",
      TopCommon, CommonWords, Practice, [], commonChars11, ~showCode=false, ~allowHints=true, ()),
    makeLesson(52, "常用字（十二）：十用發天如", "學習常用數詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars12, ~showCode=false, ~allowHints=true, ()),
    makeLesson(53, "複習：字符 41-60", "複習第四十二到四十五課的常用字",
      TopCommon, CommonWords, Review, [],
      Js.Array2.concat(commonChars9, Js.Array2.concat(commonChars10, Js.Array2.concat(commonChars11, commonChars12))),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[49, 50, 51, 52], ()),
    makeLesson(54, "綜合複習：字符 1-60", "隨機複習所有已學常用字",
      TopCommon, CommonWords, MixedReview, [],
      CangjieUtils.shuffleArray(
        Js.Array2.concat(
          Js.Array2.concat(
            Js.Array2.concat(commonChars1, Js.Array2.concat(commonChars2, Js.Array2.concat(commonChars3, commonChars4))),
            Js.Array2.concat(commonChars5, Js.Array2.concat(commonChars6, Js.Array2.concat(commonChars7, commonChars8)))
          ),
          Js.Array2.concat(commonChars9, Js.Array2.concat(commonChars10, Js.Array2.concat(commonChars11, commonChars12)))
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[37, 38, 39, 40, 43, 44, 45, 46, 49, 50, 51, 52], ()),

    // SET 4: Lessons 55-59 (Characters 61-75)
    makeLesson(55, "常用字（十三）：然作方成者", "學習常用副詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars13, ~showCode=false, ~allowHints=true, ()),
    makeLesson(56, "常用字（十四）：多日都三同", "學習常用量詞和形容詞",
      TopCommon, CommonWords, Practice, [], commonChars14, ~showCode=false, ~allowHints=true, ()),
    makeLesson(57, "常用字（十五）：已經法當起", "學習常用副詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars15, ~showCode=false, ~allowHints=true, ()),
    makeLesson(58, "複習：字符 61-75", "複習第四十八到五十課的常用字",
      TopCommon, CommonWords, Review, [],
      Js.Array2.concat(commonChars13, Js.Array2.concat(commonChars14, commonChars15)),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[55, 56, 57], ()),
    makeLesson(59, "綜合複習：字符 1-75", "隨機複習所有已學常用字",
      TopCommon, CommonWords, MixedReview, [],
      CangjieUtils.shuffleArray(
        Js.Array2.concat(
          Js.Array2.concat(
            Js.Array2.concat(
              Js.Array2.concat(commonChars1, Js.Array2.concat(commonChars2, Js.Array2.concat(commonChars3, commonChars4))),
              Js.Array2.concat(commonChars5, Js.Array2.concat(commonChars6, Js.Array2.concat(commonChars7, commonChars8)))
            ),
            Js.Array2.concat(commonChars9, Js.Array2.concat(commonChars10, Js.Array2.concat(commonChars11, commonChars12)))
          ),
          Js.Array2.concat(commonChars13, Js.Array2.concat(commonChars14, commonChars15))
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[37, 38, 39, 40, 43, 44, 45, 46, 49, 50, 51, 52, 55, 56, 57], ()),

    // SET 5: Lessons 60-65 (Characters 76-96)
    makeLesson(60, "常用字（十六）：與好看學進", "學習常用連詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars16, ~showCode=false, ~allowHints=true, ()),
    makeLesson(61, "常用字（十七）：種將還分此", "學習常用名詞和動詞",
      TopCommon, CommonWords, Practice, [], commonChars17, ~showCode=false, ~allowHints=true, ()),
    makeLesson(62, "常用字（十八）：心前面又定", "學習常用名詞和副詞",
      TopCommon, CommonWords, Practice, [], commonChars18, ~showCode=false, ~allowHints=true, ()),
    makeLesson(63, "常用字（十九）：見只主沒公從", "學習常用動詞和副詞",
      TopCommon, CommonWords, Practice, [], commonChars19, ~showCode=false, ~allowHints=true, ()),
    makeLesson(64, "複習：字符 76-96", "複習第五十三到五十六課的常用字",
      TopCommon, CommonWords, Review, [],
      Js.Array2.concat(commonChars16, Js.Array2.concat(commonChars17, Js.Array2.concat(commonChars18, commonChars19))),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[60, 61, 62, 63], ()),
    makeLesson(65, "綜合複習：前100常用字", "隨機複習所有已學的96個常用字",
      TopCommon, CommonWords, MixedReview, [],
      CangjieUtils.shuffleArray(
        Js.Array2.concat(
          Js.Array2.concat(
            Js.Array2.concat(
              Js.Array2.concat(
                Js.Array2.concat(
                  Js.Array2.concat(commonChars1, Js.Array2.concat(commonChars2, Js.Array2.concat(commonChars3, commonChars4))),
                  Js.Array2.concat(commonChars5, Js.Array2.concat(commonChars6, Js.Array2.concat(commonChars7, commonChars8)))
                ),
                Js.Array2.concat(commonChars9, Js.Array2.concat(commonChars10, Js.Array2.concat(commonChars11, commonChars12)))
              ),
              Js.Array2.concat(commonChars13, Js.Array2.concat(commonChars14, commonChars15))
            ),
            Js.Array2.concat(commonChars16, Js.Array2.concat(commonChars17, commonChars18))
          ),
          commonChars19
        )
      ),
      ~showCode=false, ~allowHints=false, ~allowGiveUp=true, ~reviewsLessons=[37, 38, 39, 40, 43, 44, 45, 46, 49, 50, 51, 52, 55, 56, 57, 60, 61, 62, 63], ()),
  ]

  // Placement test
  let placementTest = [
    makeLesson(100, "程度測驗", "測試您的倉頡輸入水平",
      Advanced, Radicals, PlacementTest, [], placementTestChars, ()),
  ]

  // Combine all lessons
  Js.Array2.concat(
    basicRadicalLessons,
    Js.Array2.concat(commonCharLessons, placementTest)
  )
}

// Cache for lessons
let allLessons = getAllLessons()

// Get lesson by ID
let getLessonById = (id: int): option<lesson> => {
  allLessons->Js.Array2.find(lesson => lesson.id == id)
}

// Get lessons by category
let getLessonsByCategory = (category: lessonCategory): array<lesson> => {
  allLessons->Js.Array2.filter(lesson => lesson.category == category)
}

// Get next lesson after completing one
let getNextLesson = (currentId: int): option<lesson> => {
  allLessons->Js.Array2.find(lesson => lesson.id == currentId + 1)
}

// Get placement test
let getPlacementTest = (): option<lesson> => {
  getLessonById(100)
}

// Create a randomized review lesson from completed lessons
let createReviewLesson = (completedLessonIds: array<int>, characterCount: int): option<lesson> => {
  // Collect all characters from completed lessons
  let allChars = completedLessonIds
    ->Js.Array2.map(id => getLessonById(id))
    ->Js.Array2.filter(Belt.Option.isSome)
    ->Js.Array2.map(Belt.Option.getExn)
    ->Js.Array2.reduce((acc, lesson) => {
      Js.Array2.concat(acc, lesson.characters)
    }, [])

  if allChars->Js.Array2.length == 0 {
    None
  } else {
    // Shuffle and take requested number of characters
    let shuffled = CangjieUtils.shuffleArray(allChars)
    let selected = shuffled->Js.Array2.slice(~start=0, ~end_=Js.Math.min_int(characterCount, shuffled->Js.Array2.length))

    Some({
      id: 9000, // Special ID for review lessons
      title: "隨機複習",
      description: `複習 ${Belt.Int.toString(selected->Js.Array2.length)} 個已學過的字`,
      section: Advanced,
      category: Custom,
      lessonType: Review,
      introducedKeys: [],
      characters: selected,
      targetAccuracy: 0.85,
      targetSpeed: Some(25.0),
      showCode: false,
      allowHints: false,
      allowGiveUp: true,
      reviewsLessons: completedLessonIds,
    })
  }
}

// Create a timed challenge lesson
let createTimedChallenge = (completedLessonIds: array<int>, durationSeconds: int): option<lesson> => {
  // Collect all characters from completed lessons
  let allChars = completedLessonIds
    ->Js.Array2.map(id => getLessonById(id))
    ->Js.Array2.filter(Belt.Option.isSome)
    ->Js.Array2.map(Belt.Option.getExn)
    ->Js.Array2.reduce((acc, lesson) => {
      Js.Array2.concat(acc, lesson.characters)
    }, [])

  if allChars->Js.Array2.length == 0 {
    None
  } else {
    // Create a large pool of characters (shuffle and repeat)
    let poolSize = 100

    // Repeat characters to create a larger pool
    let rec buildPool = (pool: array<characterInfo>, remaining: int): array<characterInfo> => {
      if remaining <= 0 {
        pool
      } else {
        let newChars = CangjieUtils.shuffleArray(allChars)
        let needed = Js.Math.min_int(remaining, newChars->Js.Array2.length)
        let toAdd = newChars->Js.Array2.slice(~start=0, ~end_=needed)
        buildPool(Js.Array2.concat(pool, toAdd), remaining - needed)
      }
    }

    let challengeChars = buildPool([], poolSize)

    Some({
      id: 9001, // Special ID for timed challenges
      title: `限時挑戰 (${Belt.Int.toString(durationSeconds)}秒)`,
      description: `在 ${Belt.Int.toString(durationSeconds)} 秒內盡可能打出更多字`,
      section: Advanced,
      category: Custom,
      lessonType: TimedChallenge,
      introducedKeys: [],
      characters: challengeChars,
      targetAccuracy: 0.80,
      targetSpeed: Some(30.0),
      showCode: false,
      allowHints: false,
      allowGiveUp: false,
      reviewsLessons: [],
    })
  }
}

// Build a map from character to its earliest lesson ID (for multi-character codes only)
// This is used for the "EarliestLesson" practice repeat mode setting
let getCharacterEarliestLessonMap = (): Belt.Map.String.t<int> => {
  // Start with empty map
  let map = ref(Belt.Map.String.empty)

  // Iterate through all lessons in order (lowest ID first)
  allLessons->Js.Array2.forEach(lesson => {
    // For each character in the lesson
    lesson.characters->Js.Array2.forEach(charInfo => {
      // Only track multi-character codes (2+ keys)
      let isMultiChar = charInfo.cangjieCode->Js.Array2.length > 1
      if isMultiChar {
        // Only set if this character hasn't been seen before
        // (since we iterate lessons in order, first occurrence is earliest)
        switch map.contents->Belt.Map.String.get(charInfo.character) {
        | None => map := map.contents->Belt.Map.String.set(charInfo.character, lesson.id)
        | Some(_) => () // Already have an earlier lesson for this character
        }
      }
    })
  })

  map.contents
}
